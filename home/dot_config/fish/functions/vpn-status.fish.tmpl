{{- /* Ultra-Zen VPN Status Check */ -}}
function vpn-status --description "Check VPN connection status via systemd service"
    # Semantic: Observe the state of our secure tunnel

    if sudo systemctl is-active --quiet goosevpn.service
        echo "ğŸŸ¢ VPN Status: Connected (systemd managed)"

        # Show service status
        set -l service_state (sudo systemctl show -p ActiveState --value goosevpn.service)
        set -l uptime (sudo systemctl show -p ActiveEnterTimestamp --value goosevpn.service)
        echo "   Service: $service_state"

        # Show tunnel interface if available
        set -l tun_ip (ip addr show tun0 2>/dev/null | grep -oP 'inet \K[\d.]+')
        if test -n "$tun_ip"
            echo "   Tunnel IP: $tun_ip"
        end

        # Show public IP (requires curl)
        if command -q curl
            set -l public_ip (curl -s https://ipinfo.io/ip 2>/dev/null)
            if test -n "$public_ip"
                echo "   Public IP: $public_ip"
            end
        end
    else
        echo "ğŸ”´ VPN Status: Disconnected"

        # Check if service exists
        if sudo systemctl list-unit-files goosevpn.service >/dev/null 2>&1
            echo "   Service: installed but inactive"
        else
            echo "   Service: not installed (run 'chezmoi apply')"
        end

        # Show current public IP if available
        if command -q curl
            set -l public_ip (curl -s https://ipinfo.io/ip 2>/dev/null)
            if test -n "$public_ip"
                echo "   Current IP: $public_ip"
            end
        end
    end
end