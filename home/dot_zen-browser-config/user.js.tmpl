{{- $theme := .themes.kanagawa.dragon -}}
{{- $s := .semantic -}}
// ════════════════════════════════════════════════════════════════════════════
// Zen Browser - User Preferences
// Generated by chezmoi from user.js.tmpl
//
// Philosophy: Privacy-first, keyboard-driven, aesthetically unified
// This config layers on top of Zen's built-in Betterfox configuration
// ════════════════════════════════════════════════════════════════════════════

// ────────────────────────────────────────────────────────────────────────────
// THEME & APPEARANCE (Semantic Colors from Kanagawa Dragon)
// ────────────────────────────────────────────────────────────────────────────

// Primary accent color - Kanagawa green (focus/active)
user_pref("zen.theme.accent-color", "{{ template "color-hex.tmpl" (index $theme $s.state.success) }}");
user_pref("zen.theme.gradient", true);
user_pref("zen.theme.gradient.show-custom-colors", true);

// Disable gray-out for inactive windows (maintain consistent colors)
user_pref("zen.view.gray-out-inactive-windows", false);

// Content element separation (border around browser window)
user_pref("zen.theme.content-element-separation", 4);

// Essential tab favicon coloring
user_pref("zen.theme.essentials-favicon-bg", true);

// Experimental rounded UI elements - disabled for YAGNI
user_pref("zen.view.experimental-rounded-view", false);

// Linux transparency support
user_pref("zen.widget.linux.transparency", false); // Disabled for solid backgrounds

// Use theme color as web content background
user_pref("browser.tabs.allow_transparent_browser", false);

// ────────────────────────────────────────────────────────────────────────────
// UI BEHAVIOR & LAYOUT
// ────────────────────────────────────────────────────────────────────────────

// Vertical Tabs Configuration
user_pref("zen.tabs.vertical", true);
user_pref("zen.tabs.show-newtab-vertical", true);
user_pref("zen.tabs.dim-pending", true);
user_pref("zen.tabs.rename-tabs", true);
user_pref("zen.view.show-newtab-button-top", false);

// Compact Mode Settings
user_pref("zen.view.compact.animate-sidebar", true);
user_pref("zen.view.compact.color-sidebar", true);
user_pref("zen.view.compact.color-toolbar", true);
user_pref("zen.view.compact.show-sidebar-and-toolbar-on-hover", true);
user_pref("zen.view.compact.toolbar-flash-popup", false); // Less visual noise
user_pref("zen.view.compact.toolbar-hide-after-hover.duration", 800);
user_pref("zen.view.show-background-tab-toast", false); // Reduce notifications

// Sidebar Configuration
user_pref("zen.view.sidebar-collapsed.hide-mute-button", false);
user_pref("zen.view.sidebar-expanded.max-width", 300);
user_pref("zen.view.sidebar-height-throttle", 200);

// Window Controls
user_pref("zen.view.hide-window-controls", false); // Show window controls for Niri
user_pref("zen.view.experimental-force-window-controls-left", false);
user_pref("zen.view.experimental-no-window-controls", false);

// Toolbar Configuration
user_pref("browser.toolbars.bookmarks.visibility", "never");

// ────────────────────────────────────────────────────────────────────────────
// WORKSPACES
// ────────────────────────────────────────────────────────────────────────────

user_pref("zen.workspaces.swipe-actions", true);
user_pref("zen.workspaces.wrap-around-navigation", true);
user_pref("zen.workspaces.natural-scroll", false);
user_pref("zen.workspaces.scroll-modifier-key", "ctrl");
user_pref("zen.workspaces.open-new-tab-if-last-unpinned-tab-is-closed", false);

// ────────────────────────────────────────────────────────────────────────────
// SPLIT VIEW
// ────────────────────────────────────────────────────────────────────────────

user_pref("zen.splitView.enable-tab-drop", true);
user_pref("zen.splitView.min-resize-width", 7);
user_pref("zen.splitView.rearrange-hover-size", 24);

// ────────────────────────────────────────────────────────────────────────────
// URL BAR & SEARCH
// ────────────────────────────────────────────────────────────────────────────

user_pref("zen.urlbar.hide-one-offs", true);
user_pref("zen.urlbar.show-domain-only-in-sidebar", true);
user_pref("zen.urlbar.show-protections-icon", true);
user_pref("zen.urlbar.wait-to-clear", 45000);
user_pref("zen.urlbar.replace-newtab", true);

// ────────────────────────────────────────────────────────────────────────────
// MEDIA CONTROLS
// ────────────────────────────────────────────────────────────────────────────

user_pref("zen.mediacontrols.enabled", true);
user_pref("media.videocontrols.picture-in-picture.enabled", true);
user_pref("media.videocontrols.picture-in-picture.enable-when-switching-tabs.enabled", false);

// ────────────────────────────────────────────────────────────────────────────
// GLANCE (Tab Preview)
// ────────────────────────────────────────────────────────────────────────────

user_pref("zen.glance.enable-contextmenu-search", true);
user_pref("zen.glance.open-essential-external-links", true);

// ────────────────────────────────────────────────────────────────────────────
// TAB MANAGEMENT
// ────────────────────────────────────────────────────────────────────────────

user_pref("zen.ctrlTab.show-pending-tabs", false);
user_pref("zen.startup.smooth-scroll-in-tabs", true);
user_pref("toolkit.tabbox.switchByScrolling", false);

// ────────────────────────────────────────────────────────────────────────────
// KEYBOARD SHORTCUTS
// ────────────────────────────────────────────────────────────────────────────

user_pref("zen.keyboard.shortcuts.enabled", true);

// ────────────────────────────────────────────────────────────────────────────
// ZEN MODS SYSTEM
// ────────────────────────────────────────────────────────────────────────────

// Disable all Zen Mods - we use userChrome.css for complete control
user_pref("zen.themes.disable-all", false);

// ────────────────────────────────────────────────────────────────────────────
// YAGNI REMOVALS - Unnecessary Visual Features
// ────────────────────────────────────────────────────────────────────────────

user_pref("zen.watermark.enabled", false); // No splash screen
user_pref("zen.downloads.download-animation", false); // Less visual noise

// ────────────────────────────────────────────────────────────────────────────
// PRIVACY & SECURITY
// ────────────────────────────────────────────────────────────────────────────
// Zen includes Betterfox by default. These settings layer additional hardening.

// Enhanced Tracking Protection
user_pref("browser.contentblocking.category", "strict");
user_pref("privacy.globalprivacycontrol.enabled", true);
user_pref("privacy.globalprivacycontrol.was_ever_enabled", true);

// Do Not Track
user_pref("privacy.donottrackheader.enabled", true);

// Referrer Policy
user_pref("network.http.referer.XOriginPolicy", 2);
user_pref("network.http.referer.XOriginTrimmingPolicy", 2);

// WebRTC Privacy
user_pref("media.peerconnection.ice.default_address_only", true);
user_pref("media.peerconnection.ice.no_host", true);

// HTTPS-Only Mode
user_pref("dom.security.https_only_mode", true);
user_pref("dom.security.https_only_mode_ever_enabled", true);

// Resist Fingerprinting (Partial - full RFP breaks some sites)
user_pref("privacy.resistFingerprinting.letterboxing", true);

// Cookies
user_pref("network.cookie.cookieBehavior", 5); // Reject known trackers and partition third-party cookies
user_pref("privacy.partition.always_partition_third_party_non_cookie_storage", true);

// Telemetry Removal (Redundant with Betterfox, but explicit)
user_pref("datareporting.policy.dataSubmissionEnabled", false);
user_pref("datareporting.healthreport.uploadEnabled", false);
user_pref("toolkit.telemetry.unified", false);
user_pref("toolkit.telemetry.enabled", false);
user_pref("toolkit.telemetry.server", "data:,");
user_pref("toolkit.telemetry.archive.enabled", false);
user_pref("toolkit.telemetry.newProfilePing.enabled", false);
user_pref("toolkit.telemetry.shutdownPingSender.enabled", false);
user_pref("toolkit.telemetry.updatePing.enabled", false);
user_pref("toolkit.telemetry.bhrPing.enabled", false);
user_pref("toolkit.telemetry.firstShutdownPing.enabled", false);

// Firefox Suggest
user_pref("browser.urlbar.suggest.quicksuggest.sponsored", false);
user_pref("browser.urlbar.suggest.quicksuggest.nonsponsored", false);

// ────────────────────────────────────────────────────────────────────────────
// PERFORMANCE
// ────────────────────────────────────────────────────────────────────────────
// Betterfox already optimizes these, but we can tune further.

// Hardware Acceleration
user_pref("gfx.webrender.all", true);
user_pref("media.ffmpeg.vaapi.enabled", true); // Linux VA-API hardware video decoding

// ────────────────────────────────────────────────────────────────────────────
// USERCHROME.CSS SUPPORT
// ────────────────────────────────────────────────────────────────────────────

// CRITICAL: Enable userChrome.css customization
user_pref("toolkit.legacyUserProfileCustomizations.stylesheets", true);

// Enable Browser Toolbox for live CSS editing (Ctrl+Shift+Alt+I)
user_pref("devtools.chrome.enabled", true);
user_pref("devtools.debugger.remote-enabled", true);

// ────────────────────────────────────────────────────────────────────────────
// DEVELOPER TOOLS
// ────────────────────────────────────────────────────────────────────────────

// Dark theme for dev tools (consistency)
user_pref("devtools.theme", "dark");
