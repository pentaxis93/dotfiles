# Zen Browser - Privacy-Focused Firefox Fork

## Ultra-Zen Philosophy
**"The browser becomes a sanctuary; privacy preserved, aesthetics unified, keyboard commands flowing"**

## Architecture
- **Firefox-Based** - Built on latest Firefox (145.0.1+) with 0-72 hour update lag
- **Privacy-First** - All telemetry stripped, zero data collection, Betterfox defaults
- **Vertical Tabs** - Arc-style sidebar with workspace organization
- **Semantic Colors** - Complete Kanagawa Dragon theming via userChrome.css templates
- **Keyboard-Driven** - Extensive shortcuts, custom keybindings via zen-keyboard-shortcuts.json
- **Split View** - Built-in tiling window manager for tabs
- **Workspaces** - Tab grouping by project/topic
- **Niri Integration** - Primary browser, launched via semantic keybinding (MOD+B)

## Configuration Files
- **user.js**: `home/dot_zen-browser-config/user.js.tmpl` - Privacy hardening and semantic color preferences
- **userChrome.css**: `home/dot_zen-browser-config/userChrome.css.tmpl` - Complete Kanagawa Dragon UI theme
- **Setup Script**: `home/run_onchange_setup-zen-browser.sh.tmpl` - Auto-deploy configs to profile
- **Niri Integration**: `home/dot_config/niri/config.kdl.tmpl` - Browser keybinding (MOD+B)
- **Package**: `home/.chezmoidata/packages.yaml` - zen-browser-bin (AUR)

## Profile Structure
```
~/.zen/[profile-id].Default (release)/
├── chrome/
│   ├── userChrome.css      # Deployed by setup script
│   └── zen-themes.css      # Auto-generated by Zen Mods (don't edit)
├── user.js                 # Deployed by setup script
├── prefs.js                # Auto-managed by browser
└── zen-keyboard-shortcuts.json  # Future: semantic keybinding integration
```

## Usage
```bash
# Launch from Niri
MOD+B                      # Semantic browser invoke keybinding

# Launch from terminal
zen-browser                # Direct launch
zen-browser [url]          # Open specific URL

# Live CSS editing
Ctrl+Shift+Alt+I           # Open Browser Toolbox
# Navigate to Style Editor → Filter for "userChrome"
# Edit and save (Ctrl+S) for instant preview
```

## Key Features

### Privacy & Security
- **Betterfox Defaults** - Pre-configured privacy/security/performance optimizations
- **Zero Telemetry** - All Firefox data collection stripped
- **Strict Tracking Protection** - Enhanced content blocking
- **HTTPS-Only Mode** - Automatic HTTPS upgrades
- **Global Privacy Control** - GPC header enabled
- **Cookie Partitioning** - CHIPS and state partitioning enabled
- **WebRTC Hardening** - IP leak prevention

### Vertical Tabs & Workspaces
- **Vertical Tab Sidebar** - Arc-style navigation with icons
- **Workspaces** - Organize tabs by project (similar to Opera)
- **Tab Renaming** - Rename pinned tabs for clarity
- **Dim Pending Tabs** - Visual indication of unloaded tabs
- **Swipe Navigation** - Trackpad gestures for workspace switching

### Compact Mode
- **Auto-Hide Sidebar** - Maximize screen space
- **Hover Reveal** - Sidebar appears on hover
- **Animated Transitions** - Smooth show/hide
- **Customizable Delay** - 800ms hide after hover

### Split View
- **Tab Tiling** - Built-in window management for tabs
- **Drag-to-Split** - Intuitive tab arrangement
- **Flexible Layouts** - Horizontal, vertical, grid
- **Minimum Size** - 7% minimum pane width

### Semantic Color System Integration
All UI elements themed from `colors.yaml`:
- **Backgrounds** - background.default, surface.default, surface.elevated, surface.overlay
- **Text** - text.default, text.muted, text.disabled
- **States** - state.success (green), state.warning (yellow), state.error (red), state.info (blue)
- **Interactive** - border.focus, selection.hover, selection.active
- **Borders** - border.default, border.subtle, border.focus

### userChrome.css Customization
Complete Kanagawa Dragon theme covering:
- Main window and toolbars
- Vertical tab sidebar (active/hover/pinned states)
- Workspaces indicators
- URL bar and search
- Context menus and dropups
- Sidebar (bookmarks, history)
- Findbar (search in page)
- Notification boxes
- Buttons and input fields
- Scrollbars
- Downloads panel
- Split view separators
- Compact mode styling
- Tooltips and status panels
- Reader mode
- Picture-in-Picture controls
- Glance (tab preview)
- Media controls

## Zen-Specific Features

### Zen Mods System
- **Marketplace** - Community themes and plugins
- **CSS Generation** - Auto-generates zen-themes.css
- **Preference Integration** - Mods define custom prefs accessible as CSS variables
- **Disabled by default** - We use userChrome.css for complete control

### Picture-in-Picture
- **Auto-Float** - PiP windows float in Niri via window rule
- **Regex Match** - Window rule matches both Firefox and Zen PiP windows

### Glance (Tab Preview)
- **Context Menu Integration** - Search in Glance from right-click
- **External Links** - Open external links in preview overlay

### Media Controls
- **Native Player** - Built-in media interface
- **PiP Support** - Enable Picture-in-Picture for videos

## Installation Flow

### 1. Package Installation
```bash
chezmoi apply  # Installs zen-browser-bin from AUR
```

### 2. First Launch
```bash
zen-browser    # Creates profile at ~/.zen/[profile-id].Default/
```

### 3. Configuration Deployment
```bash
chezmoi apply  # Triggers run_onchange_setup-zen-browser.sh
               # Deploys user.js and userChrome.css to profile
```

### 4. Restart Browser
Close and reopen Zen Browser to apply user.js preferences.

## Configuration Philosophy

### What We Configure
✅ **Privacy Hardening** - Layer additional protections on Betterfox defaults
✅ **Semantic Colors** - Complete UI theming from colors.yaml
✅ **UI Behavior** - Vertical tabs, workspaces, compact mode, split view
✅ **YAGNI Removals** - Disable splash screen, download animations
✅ **userChrome.css Support** - Enable legacy customizations stylesheet
✅ **Developer Tools** - Enable Browser Toolbox for live CSS editing

### What We Don't Configure
❌ **Keyboard Shortcuts** - Zen's default shortcuts are well-designed (future: semantic integration)
❌ **Zen Mods** - Keep disabled to avoid conflicts with userChrome.css
❌ **Extensions** - User choice, not dotfiles concern
❌ **Search Engines** - User preference, not architectural

## Live CSS Development Workflow

### Enable Live Editing
1. Press `Ctrl+Shift+Alt+I` to open Browser Toolbox
2. Navigate to **Style Editor** tab
3. Filter for "userChrome" in search box
4. Edit CSS directly in right pane
5. Press `Ctrl+S` to save and apply instantly

### Tips
- Enable "Disable Popup Auto-Hide" in Browser Toolbox to inspect hidden UI
- Use `!important` if styles don't apply (specificity issues)
- Changes persist to userChrome.css file
- Restart not needed for CSS changes

### Updating Template
After finalizing changes in live editor:
1. Copy modified CSS from userChrome.css
2. Update `home/dot_zen-browser-config/userChrome.css.tmpl`
3. Verify semantic color templates still work
4. Run `chezmoi apply` to deploy

## Troubleshooting

### Profile Not Found
**Problem**: Setup script can't find Zen profile
**Solution**: Launch Zen Browser once to create profile, then run `chezmoi apply`

### userChrome.css Not Loading
**Problem**: Custom styles not applied
**Solution**: Check that `toolkit.legacyUserProfileCustomizations.stylesheets` is `true` in about:config

### Colors Look Wrong
**Problem**: Theme colors don't match expected Kanagawa Dragon
**Solution**:
1. Verify colors.yaml is up to date
2. Run `chezmoi apply` to regenerate templates
3. Check userChrome.css in Browser Toolbox Style Editor
4. Restart Zen Browser

### Zen Mods Conflicts
**Problem**: Installed Zen Mods override userChrome.css
**Solution**: Disable Zen Mods via `zen.themes.disable-all` pref (already set in our user.js)

### PiP Windows Not Floating
**Problem**: Picture-in-Picture windows tile in Niri
**Solution**: Window rule in niri config should match app-id regex `^(firefox|zen-browser)$`

## Future Enhancements

### Potential Additions
- **zen-keyboard-shortcuts.json.tmpl** - Generate shortcuts from keybindings.yaml
- **Fish Functions** - Optional `zb` wrapper if user wants shell integration
- **Search Engines** - Optional template for default search engines
- **Extensions** - Document recommended privacy extensions (uBlock Origin, etc.)
- **Betterfox Updates** - Track upstream Betterfox changes

### Not Planned (YAGNI)
- ❌ Automatic extension installation (user choice)
- ❌ Container tabs configuration (advanced user feature)
- ❌ Custom new tab page (preference, not architecture)
- ❌ Bookmark management (user data, not config)

## Comparison with Qutebrowser

### Why Zen Browser?
- **Firefox Base** - Better web compatibility, modern standards support
- **Privacy Foundation** - Betterfox + zero telemetry by default
- **Visual Polish** - Modern UI, vertical tabs, workspaces
- **Split View** - Built-in tab tiling
- **Extension Support** - Full Firefox extension ecosystem

### Qutebrowser Advantages
- **Vim Purity** - Native vim-like keybindings
- **Minimal Resource Usage** - Lower memory footprint
- **Python Configuration** - Programmatic config.py
- **Pure Keyboard** - Zero mouse dependency

### Coexistence
Both browsers serve different needs:
- **Zen Browser** - Primary browser (MOD+B), general web browsing
- **Qutebrowser** - Keyboard purist, scriptable workflows, lightweight sessions

No conflict - both can be installed and used as needed.

## Architecture Compliance

### Semantic Color System ✓
- All colors defined in colors.yaml
- Complete userChrome.css templates with semantic mappings
- No hardcoded hex values
- Single source of truth maintained

### Semantic Keybindings ✓
- Niri integration uses semantic invoke.browser action
- PiP window rule follows semantic patterns
- Future: zen-keyboard-shortcuts.json semantic generation

### YAGNI Philosophy ✓
- Minimal configuration (only what improves privacy/aesthetics)
- No unnecessary features enabled
- Splash screen and animations disabled
- Zen Mods disabled to avoid complexity

### Privacy-First ✓
- Betterfox defaults respected
- Additional hardening layered on top
- Zero telemetry explicitly confirmed
- Tracking protection set to strict

### Documentation ✓
- Comprehensive inline comments in user.js
- CSS comments explaining semantic color mappings
- Setup script with clear output messages
- This complete reference document

---

*"The browser is not merely a window to the web; it is a sanctuary where privacy, aesthetics, and intention unite."*
